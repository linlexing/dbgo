<#if not .Translate_en#>
	<#set . "Translate_en" mkMap#>
<#end#>
<#set .Translate_en "SEARCH" "Search"#>
<#set .Translate_en "OPT_PREX" "Prefix"#>
<#set .Translate_en "OPT_EQ" "Equal"#>
<#set .Translate_en "OPT_LIKE" "Like"#>
<#set .Translate_en "OPT_NE" "NotEqual"#>
<#set .Translate_en "OPT_LT" "LessThan"#>
<#set .Translate_en "OPT_LE" "LTE"#>
<#set .Translate_en "OPT_GT" "GreaterThan"#>
<#set .Translate_en "OPT_GE" "GTE"#>
<#set .Translate_en "OPT_IN" "In"#>
<#set .Translate_en "OPT_NIN" "NotIn"#>
<#set .Translate_en "OPT_REGEXP" "RegExp"#>
<#set .Translate_en "OPT_SUFX" "Suffix"#>

<#if not .Translate_cn#>
	<#set . "Translate_cn" mkMap#>
<#end#>
<#set .Translate_cn "SEARCH" "搜索"#>
<#set .Translate_cn "OPT_PREX" "前缀"#>
<#set .Translate_cn "OPT_EQ" "等于"#>
<#set .Translate_cn "OPT_LIKE" "包含"#>
<#set .Translate_cn "OPT_NE" "不等于"#>
<#set .Translate_cn "OPT_LT" "小于"#>
<#set .Translate_cn "OPT_LE" "小于等于"#>
<#set .Translate_cn "OPT_GT" "大于"#>
<#set .Translate_cn "OPT_GE" "大于等于"#>
<#set .Translate_cn "OPT_IN" "在列表"#>
<#set .Translate_cn "OPT_NIN" "不在列表"#>
<#set .Translate_cn "OPT_REGEXP" "正则"#>
<#set .Translate_cn "OPT_SUFX" "后缀"#>

<#template "pjheader.html" .#>
<link rel="stylesheet" type="text/css" href=<#static "recordview/show.css"#>></link>
<script>
var spinner;
function showSpin(){
	var opts = {
	  lines: 8, // The number of lines to draw
	  length: 2, // The length of each line
	  width: 2, // The line thickness
	  radius: 4, // The radius of the inner circle
	  corners: 1, // Corner roundness (0..1)
	  rotate: 0, // The rotation offset
	  direction: 1, // 1: clockwise, -1: counterclockwise
	  color: '#000', // #rgb or #rrggbb or array of colors
	  speed: 1, // Rounds per second
	  trail: 60, // Afterglow percentage
	  shadow: false, // Whether to render a shadow
	  hwaccel: false, // Whether to use hardware acceleration
	  className: 'spinner', // The CSS class to assign to the spinner
	  zIndex: 2e9, // The z-index (defaults to 2000000000)
	  top: '50%', // Top position relative to parent
	  left: '50%' // Left position relative to parent
	};
	spinner = new Spinner(opts).spin($("#spinDiv")[0]);

}
function hideSpin(){
	if(spinner)
		spinner.stop();
}
app.controller('mainCtrl', ['$translate', '$scope','$alert','$http','$timeout',function ($translate, $scope,$alert,$http,$timeout) {
	$translate("LABEL").then(function(label){
		document.title=label;
	});
	$scope.pending = 0;
	$scope.time = 10.0;
	$scope.search = {field :null,opt:"equ",value:""};
	$scope.searchOpts = ["OPT_PREX","OPT_EQ","OPT_LIKE","OPT_NE","OPT_LT","OPT_LE","OPT_GT","OPT_GE","OPT_IN","OPT_NIN","OPT_REGEXP","OPT_SUFX"];
	$scope.navCollapsed=true;
	$scope.data={columns:[],data:{},total:0};
	$scope.scrollTop = 0;
	$scope.$translate = $translate;
	$(window).scroll(function (e){
		$scope.$apply(function(){
			$scope.scrollTop =Math.max(0,$("body").scrollTop()-$(".content").offset().top)+"px" ;
		});
	});
	$scope.$watch("pending",function(newvalue,oldvalue){
		if(newvalue >0){
			showSpin();
		}else{
			hideSpin();
		}
	});
	$scope.refreshData= function(){
		var searchOptions ={};
		if($scope.search.field){
			searchOptions={
				search:{
					field:$scope.search.field.fieldName,
					opt:$scope.search.opt,
					value:$scope.search.value
				}
			};
		}
		$scope.navCollapsed = true;
		console.log(searchOptions);
		$scope.pending ++;
		$http.post(<#.data_action#>,searchOptions)
			.success(function(data,status,headers,config,statusText){
				//$scope.myData = $.parseJSON(JSON.parse(data.data));
				$scope.data.data = data.data;
				$scope.data.columns = data.columns;
				$scope.pending --;
			})
			.error(function(data,status,headers,config,statusText){
				$alert({title: 'error', content:data.error, placement: 'top-right', type: 'danger', show: true});
				$scope.pending --;
			});
	}
	$scope.refreshData();
}]);
</script>
<script type="text/ng-template" id="process.html">
<ul class="dropdown-menu">
	<li><a href="">test1</a></li>
	<li><a href="">test1</a></li>
	<li><a href="">test1</a></li>
	<li><a href="">test1</a></li>
</ul>
</script>
<script type="text/ng-template" id="privateTemplate.html">
<ul class="dropdown-menu">
	<li><a href="">test1</a></li>
	<li><a href="">test1</a></li>
	<li><a href="">test1</a></li>
	<li><a href="">test1</a></li>
</ul>
</script>

<div ng-controller="mainCtrl">
	<nav role="navigation" class="navbar navbar-default">
	    <!-- Brand and toggle get grouped for better mobile display -->
	    <div class="navbar-header">
			<div ng-show="pending==0" class="navbar-brand navbar-left" data-animation="am-flip-x" bs-dropdown data-template="process.html" data-placement="bottom-left" data-container="body">
				<a href="">
					<i class="fa fa-th"></i>
				</a>
			</div>
			<div class="navbar-brand navbar-left spin" ng-show="pending>0">
				<div id="spinDiv"></div>
			</div>
	        <button type="button" ng-click="navCollapsed = !navCollapsed" class="navbar-toggle">
	            <span class="sr-only">Toggle navigation</span>
	            <span class="icon-bar"></span>
	            <span class="icon-bar"></span>
	            <span class="icon-bar"></span>
	        </button>
	    </div>
	    <!-- Collection of nav links and other content for toggling -->
	    <div class="collapse navbar-collapse"  ng-class="{'in':!navCollapsed}">
			<form class="navbar-form navbar-left" role="search">
					<select class="form-control" ng-model="search.field" ng-options="column.displayName[$translate.use()] for column in data.columns track by column.fieldName">
						<option value=""></option>
					</select>
					<select class="form-control" ng-model="search.opt" ng-options="item|translate for item in searchOpts">
					</select>
					<input type="text" class="form-control" placeholder="{{'SEARCH'|translate}}" ng-model="search.value"></input>
					<button type="submit" class="btn btn-default" ng-click="refreshData()" ng-disabled="pending">
						<i class="fa fa-search"></i>
					</button>
			</form>
			<form class="navbar-form navbar-right" role="search">
				<div class="form-group">
					<label>模板(公):</label>
					<select class="form-control">
					  <option>1</option>
					  <option>2</option>
					  <option>3</option>
					  <option>4</option>
					  <option>5</option>
					</select>
					<a class="btn btn-default"><i class="fa fa-pencil-square-o"></i></a>
				</div>
				<div class="form-group">
					<label>私:</label>
					<select class="form-control">
					  <option>1</option>
					  <option>2</option>
					  <option>3</option>
					  <option>4</option>
					  <option>5</option>
					</select>
					<a class="btn btn-default"><i class="fa fa-pencil-square-o"></i></a>
				</div>
			</form>
	    </div>
	</nav>
	<div class="content">
		<table class="table table-striped table-bordered table-hover">
			<thead>
				<tr>
					<th ng-repeat="column in data.columns" style="top:{{scrollTop}}">
					{{column.displayName[$translate.use()]}}
					</th>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat="item in data.data">
					<td ng-repeat="column in data.columns">
						{{item[column.fieldName]}}
					</td>
				</tr>
			</tbody>
		</table>
	</div>
</div>
<#template "pjfooter.html" .#>
